# P4933

## 题目描述

ljt12138 首先建了 n*n* 个特斯拉电磁塔，这些电塔排成一排，从左到右依次标号为 11 到 n*n* ，第 i*i* 个电塔的高度为 h[i]*h*[*i*] 。

建筑大师需要从中选出一些电塔，然后这些电塔就会缩到地下去。这时候，如果留在地上的电塔的高度，从左向右构成了一个等差数列，那么这个选择方案就会被认为是美观的。

建筑大师需要求出，一共有多少种美观的选择方案，答案模 $998244353$ 。

注意，如果地上只留了一个或者两个电塔，那么这种方案也是美观的。地上没有电塔的方案被认为是不美观的。

同时也要注意，等差数列的公差也可以为负数。

## 输入格式

第一行一个正整数 *$n$* 。

第二行 *$n$* 个非负整数，第 *$i$* 个整数是第*$i$* 个电塔的高度 *$h$*[*$i$*] 。

## 输出格式

输出一个整数，表示美观的方案数模 $998244353$ 的值。

## 数据范围

$\large n\leq 10^3,v\leq2\times10^4$

## 分析：

首先，分析一下，不像是什么鬼畜 DS 题，再看一下数据范围，感觉像是一个 DP ，$\Omicron(n^2),\Omicron(nv)$ 都可过。

这样自然想到了一个状态设计：

$dp[i][j]$ 表示到第 $i$ 个点为止公差为 $j$ 的方案总数。

由此，我们的到了其转移方程：

$$\Large dp[i][j] = \sum\limits_{a[i]-a[k]=j}^{j-1}dp[k][j]$$

它的状态转移是 $\Omicron(n)$ 的，总时间复杂度 $\Omicron(n^2v)$,因该是过不了的，要改进。

我们可以预先处理处 $i$ 与其前面的数的公差，耗时 $\Omicron(n^2)$ ，用二维 $vector$ 存起来。

这样每次转移就是 $\Omicron(1)$ 的。

总时间复杂度 $\Omicron(nv)$ ，可以过。

但是上面的这个版本代码不好搞，我调了半天，也没调出来。

瞄了一眼题解，继续上面的转移方程：

$$\Large dp[i][j] = \sum\limits_{a[i]-a[k]=j}^{j-1}dp[k][j]$$

我们换一种枚举方式：

尾巴上的 $+1$ 容易漏到，但它却是指 $a[i],a[j]$ 单独成为序列的情况。

$\Large dp[i][a[i]-a[k]] = dp[i][a[i]-a[k]] + dp[k][a[i]-a[k]] + 1\ \ \ \ \ \ \ \ \ k\in(0,i)$

这样的话是易看出其时间复杂度为 $\Omicron(n^2)$ ，暴打了上面的 $\Omicron(nv)$ 的转移方程。

本身也比较好写。

~~事实证明我还是太菜了。~~